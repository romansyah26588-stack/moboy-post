// 1. schema.prisma
// Pastikan skema ini sinkron dengan penggunaan walletAddress di API route

generator client {
  provider = "prisma-client-js"
}

// provider sudah benar: sqlite untuk D1
datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id              String    @id @default(cuid())
  walletAddress   String    @unique // Kunci ini akan dirujuk
  name            String?
  profileImage    String?
  totalEarnings   Float     @default(0)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  contents        Content[]
  earnings        Earning[]
}

model Content {
  id              String    @id @default(cuid())
  link            String    @unique
  userId          String    // Kunci Asing (Harus menampung walletAddress)
  viewCount       Int       @default(0)
  isActive        Boolean   @default(true)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  // PERBAIKAN: references sekarang menunjuk ke [walletAddress]
  users           User      @relation(fields: [userId], references: [walletAddress], onDelete: Cascade)
}

model Earning {
  id              String    @id @default(cuid())
  userId          String    // Kunci Asing (Harus menampung walletAddress)
  amount          Float
  description     String?
  createdAt       DateTime  @default(now())
  
  // PERBAIKAN: references sekarang menunjuk ke [walletAddress]
  users           User      @relation(fields: [userId], references: [walletAddress], onDelete: Cascade)
}
